

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>restraintmaker.interface_Pymol.RestraintMaker_Pymol &mdash; restraintMaker  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> restraintMaker
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Welcome RestraintMaker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_source/modules.html">restraintmaker</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">restraintMaker</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>restraintmaker.interface_Pymol.RestraintMaker_Pymol</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for restraintmaker.interface_Pymol.RestraintMaker_Pymol</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This module plugs in the restraintmaker logic into PyMOL.</span>
<span class="sd">    It basically contains the GUI-realisation and the linkeage to the logic.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">typing</span> <span class="k">as</span> <span class="nn">t</span>

<span class="kn">from</span> <span class="nn">pymol</span> <span class="kn">import</span> <span class="n">cmd</span>
<span class="kn">from</span> <span class="nn">pymol.wizard</span> <span class="kn">import</span> <span class="n">Wizard</span>


<span class="kn">from</span> <span class="nn">restraintmaker.algorithm.Selection</span> <span class="kn">import</span> <span class="n">SphericalSelection</span>  <span class="c1"># Necessary for special case checks</span>
<span class="kn">from</span> <span class="nn">restraintmaker.interface_Pymol</span> <span class="kn">import</span> <span class="n">RestraintMaker_Logic</span> <span class="k">as</span> <span class="n">Logic</span>
<span class="kn">from</span> <span class="nn">restraintmaker.interface_Pymol.pymol_utilities</span> <span class="kn">import</span> <span class="n">program_states</span><span class="p">,</span> <span class="n">qt_dialogs</span>
<span class="kn">import</span> <span class="nn">restraintmaker.interface_Pymol.pymol_utilities.pymol_utitlities</span> <span class="k">as</span> <span class="nn">pu</span>

<span class="kn">from</span> <span class="nn">restraintmaker.utils</span> <span class="kn">import</span> <span class="n">Utilities</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">restraintmaker.utils.Utilities</span> <span class="kn">import</span> <span class="nb">print</span>


<div class="viewcode-block" id="Restraints_Wizard"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard">[docs]</a><span class="k">class</span> <span class="nc">Restraints_Wizard</span><span class="p">(</span><span class="n">Wizard</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class helps generating dis res.</span>
<span class="sd">    Sources: label(Wizard)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_nr</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="Restraints_Wizard.__init__"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_self</span><span class="o">=</span><span class="n">cmd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initialize PyMol to the wizard!</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span> <span class="o">=</span> <span class="n">Logic</span><span class="o">.</span><span class="n">Logic_Handler</span><span class="p">(</span><span class="n">pu</span><span class="o">.</span><span class="n">pymol_selection_to_atom_list</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">))</span>

        <span class="n">Wizard</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_wizard_style</span><span class="p">()</span>

        <span class="c1"># reset gui selections:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">unpick</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">deselect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mouse_selection_mode&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1">##generate Menu drop down</span>
        <span class="c1">### Pymols python interpreter will not be able to understand a reference to self. But we can find the Way back here via cmd.get_wizard.</span>
        <span class="c1">### We can not use the __class__  attribute: The function will be passed as a string to the interface_Pymol Python interpreter. So its ars have to be strings themselves</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="p">{</span>

            <span class="s1">&#39;Import&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Importer&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]]</span> <span class="o">+</span>
                      <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;cmd.get_wizard()._action_button_pressed(</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_importer_types</span><span class="p">],</span>
            <span class="s1">&#39;Restraint&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Restraint&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]]</span> <span class="o">+</span>
                         <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;cmd.get_wizard()._action_button_pressed(</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_restraint_types</span><span class="p">],</span>
            <span class="s1">&#39;Selection&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Selection&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]]</span> <span class="o">+</span>
                         <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;cmd.get_wizard()._action_button_pressed(</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span>
                          <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_selection_types</span><span class="p">],</span>

            <span class="s1">&#39;Filter&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Filter&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]]</span> <span class="o">+</span>
                      <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;cmd.get_wizard()._action_button_pressed(</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_filter_types</span><span class="p">],</span>
            <span class="s1">&#39;Optimizer&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Optimizer&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]]</span> <span class="o">+</span>
                         <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;cmd.get_wizard()._action_button_pressed(</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span>
                          <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_optimizer_types</span><span class="p">],</span>

            <span class="s1">&#39;Exporter&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Exporter&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]]</span> <span class="o">+</span>
                        <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;cmd.get_wizard()._action_button_pressed(</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_exporter_types</span><span class="p">],</span>
            <span class="s1">&#39;Done&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Done&#39;</span><span class="p">,</span> <span class="s1">&#39;cmd.set_wizard()&#39;</span><span class="p">]]</span>

        <span class="p">}</span>

        <span class="c1">##Settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_message</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supress_prompt</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quicksnapshot_nr</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_hashes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;atoms&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;selection&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;restraints&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;test_mode&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>  <span class="c1"># hashes to keep work of interface_Pymol: self.redraw only redraw things that actually changed\</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_result_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># crd (check_results_dict) is an dict that can beused by the test mode to store information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Check results mode indicates if we are using a special test mode at the moment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_cnt</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># The different check_opzimier_results functions indicate in whihc mode they are called</span>

        <span class="c1">## Set up objs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;retain_order&#39;</span><span class="p">)</span>  <span class="c1"># NEVER CHANGE IDS OF ATOMS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pymol_molecule_objects</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">create_pymol_objects_for_molecules</span><span class="p">()</span>  <span class="c1"># Must be done before logic handler, because it changes atom ids!</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()[</span>
                                <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Delete the object containing all molecules. If not all Molecules are doubled</span>

        <span class="c1">## Update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">refresh_wizard</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">viewing</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pymol event handling</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The trigger-event method is used to translate the interface_Pymol events into events the selections can deal with, by calling the corresponding Logic_handler.react_to_*_event function</span>
    <span class="c1"># TODO STUC: Decide wether to redraw automatically after each event, or wether to trigger the redrawing from the Logic module.</span>

<div class="viewcode-block" id="Restraints_Wizard.get_event_mask"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.get_event_mask">[docs]</a>    <span class="k">def</span> <span class="nf">get_event_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Wizard</span><span class="o">.</span><span class="n">event_mask_pick</span> <span class="o">+</span> <span class="n">Wizard</span><span class="o">.</span><span class="n">event_mask_select</span> <span class="o">+</span> <span class="n">Wizard</span><span class="o">.</span><span class="n">event_mask_special</span> <span class="o">+</span> <span class="n">Wizard</span><span class="o">.</span><span class="n">event_mask_key</span> \
               <span class="o">+</span> <span class="n">Wizard</span><span class="o">.</span><span class="n">event_mask_dirty</span>  <span class="c1"># Event_maks_special = Arrow keys</span></div>

<div class="viewcode-block" id="Restraints_Wizard.trigger_event"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.trigger_event">[docs]</a>    <span class="k">def</span> <span class="nf">trigger_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="n">program_states</span><span class="o">.</span><span class="n">EventType</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_args</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Any</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            trigger_event will call the logic_handler&#39;s appropriate react_to_*_event function, depending on event_type</span>
<span class="sd">            and cause the wizard and the view to apply the changes caused by the event.</span>

<span class="sd">            TypeError will be thrown if trigger_event is called without explicitly stating the keywords of the target update function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event_type :program_states.EventType</span>
<span class="sd">            what event has been caused? Acceptable values: &#39;select&#39;, &#39;move&#39;, &#39;size&#39;, &#39;confirm&#39;</span>
<span class="sd">        kw_args : t.Any</span>
<span class="sd">            Arguments the relevant update functon will need. KEYWORDS OF THE CORRESPONDING _Selection._update_* function MUST BE GIVEN. (** =&gt; dict)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NoReturn</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            if event_type can not be resolved to a logic.handler.react_to_*_event function</span>
<span class="sd">        u.BadArgumentException</span>
<span class="sd">            if args to not match the the corresponding logic_handler.react_to_*_event_function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">react_to_event</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">refresh_wizard</span><span class="p">()</span></div>

<div class="viewcode-block" id="Restraints_Wizard.do_special"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.do_special">[docs]</a>    <span class="k">def</span> <span class="nf">do_special</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">mod</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            control special actions of the keyboard</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        k : int</span>
<span class="sd">            pressed key</span>
<span class="sd">        x : int</span>
<span class="sd">            coordinate x</span>
<span class="sd">        y : float</span>
<span class="sd">            coordinate y</span>
<span class="sd">        mod : int</span>
<span class="sd">            pressed shift?</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;special&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span><span class="o">.</span><span class="n">has_finished</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">102</span><span class="p">:</span>  <span class="c1"># right - arrow key</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="n">program_states</span><span class="o">.</span><span class="n">EventType</span><span class="o">.</span><span class="n">SIZE</span><span class="p">,</span> <span class="n">increase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># increase = True</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">):</span>  <span class="c1"># if it is Spherical Selection increase sphere size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;sphere_scale&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;SphericalSelection&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># left - arrow key</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="n">program_states</span><span class="o">.</span><span class="n">EventType</span><span class="o">.</span><span class="n">SIZE</span><span class="p">,</span> <span class="n">increase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># increase = False</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">):</span>  <span class="c1"># if it is Spherical Selection reduce sphere size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;sphere_scale&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;SphericalSelection&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">101</span><span class="p">:</span>  <span class="c1"># + -key</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">controlling</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Left&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;MovA&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">103</span><span class="p">:</span>  <span class="c1"># down - key</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">controlling</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Left&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Rota&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">101</span> <span class="ow">and</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># up + Shift - keys</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="n">program_states</span><span class="o">.</span><span class="n">EventType</span><span class="o">.</span><span class="n">CONFIRM</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">controlling</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Left&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Rota&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">controlling</span><span class="o">.</span><span class="n">unmask</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;SphericalSelection&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">_set_selection_type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Restraints_Wizard.do_dirty"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.do_dirty">[docs]</a>    <span class="k">def</span> <span class="nf">do_dirty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            TODO: Find a better way to detect movement of pseudoatom: Do_position? / Save last positon and only call do move if it actually moved</span>
<span class="sd">            TODO STRUC: Move this out to a provider function. The GUI handling program should not deal with special cases for certain selction types.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dirty&#39;</span><span class="p">,</span> <span class="n">mv</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>  <span class="c1"># only for debugging</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span><span class="p">,</span> <span class="n">SphericalSelection</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_objects_exists</span><span class="p">(</span><span class="s1">&#39;SphericalSelection&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">provide_services_to_spherical_selection</span><span class="p">()</span>

            <span class="c1"># Find the coordinates of the Spherical selection</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">iterate_state</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;SphericalSelection&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">=</span><span class="s1">&#39;coords[0]=(x,y,z)&#39;</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="nb">locals</span><span class="p">())</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="n">program_states</span><span class="o">.</span><span class="n">EventType</span><span class="o">.</span><span class="n">MOVE</span><span class="p">,</span> <span class="n">new_x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">new_y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">new_z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="Restraints_Wizard.do_key"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.do_key">[docs]</a>    <span class="k">def</span> <span class="nf">do_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">mod</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        k : int</span>
<span class="sd">            pressed key</span>
<span class="sd">        x :  float</span>
<span class="sd">            coordinate x</span>
<span class="sd">        y : float</span>
<span class="sd">            coordinate y</span>
<span class="sd">        mod :</span>
<span class="sd">            shift pressed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Does not deal with events passed down to Selection</span>
        <span class="c1"># Check what the current test mode is and do the appropriate action at each key. Problem: FBefore test mode 4 i did not use crd and self.test_mode but just checked if attributes set by the test functions are present</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">mv</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">13</span> <span class="ow">and</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Enter</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_optimzer_results_pairwise_4</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_optimzer_results_pairwise_6</span><span class="p">()</span>  <span class="c1"># Show_next+True by default</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_to2_i_m&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_to2_i_m</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to2_i_m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_optimzer_show_next_molecule_pair_2</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_to3_i_m&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_to3_i_m</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_to3_i_m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">())</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_optimzer_show_next_molecule_pair_3</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">13</span> <span class="ow">and</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># shift Enter</span>
            <span class="c1"># Start or end test mode 5</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_optimzer_results_pairwise_4</span><span class="p">(</span><span class="n">exit_test_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_optimzer_results_pairwise_5</span><span class="p">(</span><span class="n">exit_test_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_optimzer_results_pairwise_6</span><span class="p">(</span><span class="n">exit_test_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_restraints</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_optimzer_results_pairwise_6</span><span class="p">()</span>


        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># Backspace</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_optimzer_results_pairwise_6</span><span class="p">(</span><span class="n">show_next</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_to2_i_m&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_to2_i_m</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to2_i_m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_optimzer_show_next_molecule_pair_2</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;to_3_i_m&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_to3_i_m</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_to3_i_m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">())</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_optimzer_show_next_molecule_pair_3</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>  <span class="c1"># Space</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;grid_mode&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grid_mode&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">81</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">113</span><span class="p">:</span>  <span class="c1"># q or Q</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">58</span><span class="p">):</span>  <span class="c1"># Number - #TODO: seems not to work</span>
            <span class="c1"># Show the corresponidng moleucle in test mode</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">48</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="n">mv</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">mv</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pymol_molecule_objects</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_optimzer_results_pairwise_4</span><span class="p">(</span><span class="n">mol1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pymol_molecule_objects</span><span class="p">[(</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)],</span>
                                                            <span class="n">mol2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_result_dict</span><span class="p">[</span><span class="s1">&#39;mol1&#39;</span><span class="p">])</span>

        <span class="c1"># KEYBOARD SHORTCUTS FOR USEFULL FUNCTIONS. Warning: Do not use alt or Ctrl for shortcuts. Many keys are already occupied</span>
        <span class="c1"># h: Hide instructions</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">104</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_message</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># The only instruction will be how to show instructions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">refresh_wizard</span><span class="p">()</span>
        <span class="c1"># s: show instructions</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">115</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_message</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">refresh_wizard</span><span class="p">()</span>

        <span class="c1"># Shf R: Delete all restraints</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">82</span> <span class="ow">and</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_restraints</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">set_action_states</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_panel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">refresh_wizard</span><span class="p">()</span>

        <span class="c1"># Shf Q: Choose all atoms, start brute force optimizer, start test mode 4</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">81</span> <span class="ow">and</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_action_button_pressed</span><span class="p">(</span><span class="s1">&#39;UniversalSelection&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="n">program_states</span><span class="o">.</span><span class="n">EventType</span><span class="o">.</span><span class="n">CONFIRM</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_action_button_pressed</span><span class="p">(</span><span class="s1">&#39;TreeHeuristicOptimizer&#39;</span><span class="p">)</span>

            <span class="c1"># Make sure Optimizatyion was sucessfull</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_restraints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_optimzer_results_pairwise_6</span><span class="p">()</span>

        <span class="c1"># Shf T: Test Optimizers</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">84</span> <span class="ow">and</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing Optimizers...&#39;</span><span class="p">,</span> <span class="n">mv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="kn">from</span> <span class="nn">restraintmaker.algorithm</span> <span class="kn">import</span> <span class="n">Optimizer</span>
            <span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QFileDialog</span><span class="p">,</span> <span class="n">QInputDialog</span>

            <span class="n">Optimizer</span><span class="o">.</span><span class="n">compare_pair_optimizers</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="n">Optimizer</span><span class="o">.</span><span class="n">_calculate_value_convex_hull</span><span class="p">,</span> \
                                              <span class="n">atoms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_atoms</span><span class="p">,</span> \
                                              <span class="n">opt_types</span><span class="o">=</span><span class="p">[</span><span class="n">Optimizer</span><span class="o">.</span><span class="n">TreeHeuristicOptimizer</span><span class="p">,</span>
                                                         <span class="n">Optimizer</span><span class="o">.</span><span class="n">TreeHeuristicOptimizer</span><span class="p">,</span>
                                                         <span class="n">Optimizer</span><span class="o">.</span><span class="n">TreeHeuristicOptimizer</span><span class="p">,</span>
                                                         <span class="n">Optimizer</span><span class="o">.</span><span class="n">BruteForceRingOptimzer</span><span class="p">,</span>
                                                         <span class="n">Optimizer</span><span class="o">.</span><span class="n">BruteForceRingOptimzer</span><span class="p">],</span> \
                                              <span class="n">opt_args</span><span class="o">=</span><span class="p">[(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;prim&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;cog&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                                                        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;shortest&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                                                        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;convex_hull&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)],</span> \
                                              <span class="n">out_path</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span>
                                                  <span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Where should all restraints be saved?&#39;</span><span class="p">),</span>
                                              <span class="n">new_dir_name</span><span class="o">=</span>
                                              <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">get_qtwindow</span><span class="p">(),</span> <span class="s1">&#39;Directory name&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;What should the new directory be calledd?&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;... tested optimizers&#39;</span><span class="p">,</span> <span class="n">mv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Shft C: Readjust color</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">67</span> <span class="ow">and</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pu</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">all_atoms</span><span class="p">)</span>

        <span class="c1"># Shft S: Snapshot</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">83</span> <span class="ow">and</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">qt_dialogs</span><span class="o">.</span><span class="n">create_file_save_dialog</span><span class="p">()(</span>
                <span class="s2">&quot;Where should the snapshot be saved?&quot;</span><span class="p">)</span>  <span class="c1"># &#39;~/Desktop/&#39;+str(self.quicksnapshot_nr)+&#39;.png&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quicksnapshot_nr</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">png</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">refresh_wizard</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved picture at &#39;</span> <span class="o">+</span> <span class="n">file</span><span class="p">,</span> <span class="n">mv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="Restraints_Wizard.do_pick"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.do_pick">[docs]</a>    <span class="k">def</span> <span class="nf">do_pick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bondFlag</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_select</span><span class="p">(</span><span class="s1">&#39;pk1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">unpick</span><span class="p">()</span></div>

<div class="viewcode-block" id="Restraints_Wizard.do_select"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.do_select">[docs]</a>    <span class="k">def</span> <span class="nf">do_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sele</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ..function: do_generate_restraints</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">newly_selected_atoms</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">Atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">pymol_selection_to_atom_list</span><span class="p">(</span>
            <span class="n">sele</span><span class="p">)</span>  <span class="c1"># sele is deleted at the end of the function. So it now only contains atoms selected by mouse since  the last call of do select</span>

        <span class="c1"># TODO: Introduce switch table to specify action depending on the chosen selection =&gt;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="n">program_states</span><span class="o">.</span><span class="n">EventType</span><span class="o">.</span><span class="n">SELECT</span><span class="p">,</span> <span class="n">new_atoms</span><span class="o">=</span><span class="n">newly_selected_atoms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="s1">&#39;sele&#39;</span><span class="p">)</span>  <span class="c1"># Necessary, to assure that in the next call of do_select we do not get all atoms selected up to now as well</span></div>

        <span class="c1"># TODO: Change program flow:</span>
        <span class="c1"># Mode1: IF we have an active restraint type, the selection will be used to create a new restraint and add this to a list of restraints</span>
        <span class="c1"># Mode2: If there is no active restraint type, we select atoms and do not create restraints and just wildly select and filter atoms</span>
        <span class="c1"># At the moment we only have mode 1</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Buttton functions</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Restraints_Wizard._action_button_pressed"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard._action_button_pressed">[docs]</a>    <span class="k">def</span> <span class="nf">_action_button_pressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        button_pressed should be called when any of the action buttons is pressed.</span>

<span class="sd">            It will call the releveant logic_handler.set_*_type method, redraw the molecule and enable/disabnle buttons if necessary.</span>
<span class="sd">            I think it is easier to pack all buttons into one function, and go through a switch table, than to define seperate functions for importer, Selection etc,</span>
<span class="sd">            plus a function called in all cases</span>

<span class="sd">        :param x_name: The __name__ attribute of a type Importer, Restraint, Selection, Filter, Optimizer or Exporter</span>
<span class="sd">        :type x_name: str</span>
<span class="sd">        :raises: TypeError if x_type is not a type of Importer, Restraint, Selection, Filter, Optimizer or Exporter</span>
<span class="sd">        :return -</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        :warning: The x_type attribute MUST be of type string, not type, because of technical issues:\</span>
<span class="sd">         To be able to pass this function to the interface_Pymol pyhton interpreter all its arguments need to be of type string\</span>
<span class="sd">         So the interface_Pymol module will work with __name__ instead of __class__ attributes</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Because we get __name__ and not __class__ attributes for x_type (-&gt;see warning in docstring), we have to tediously convert it back to  a type</span>
        <span class="c1"># Using types instead of names is much more sensible, so I want to do the conversion here and not in the logic_module, as this is a interface_Pymol specific problem.</span>

        <span class="c1"># SWITCH-TABLE to convert from name to type:</span>
        <span class="n">x_type</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Importer</span>
        <span class="k">if</span> <span class="n">x_type</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_importer_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i_type</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">x_name</span><span class="p">:</span>
                    <span class="n">x_type</span> <span class="o">=</span> <span class="n">i_type</span>

        <span class="c1"># Restraint</span>
        <span class="k">if</span> <span class="n">x_type</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_restraint_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">r_type</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">x_name</span><span class="p">:</span>
                    <span class="n">x_type</span> <span class="o">=</span> <span class="n">r_type</span>

        <span class="c1"># Selection</span>
        <span class="k">if</span> <span class="n">x_type</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_selection_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s_type</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">x_name</span><span class="p">:</span>
                    <span class="n">x_type</span> <span class="o">=</span> <span class="n">s_type</span>

        <span class="c1"># Filter</span>
        <span class="k">if</span> <span class="n">x_type</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_filter_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f_type</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">x_name</span><span class="p">:</span>
                    <span class="n">x_type</span> <span class="o">=</span> <span class="n">f_type</span>

        <span class="c1"># Optimizer</span>
        <span class="k">if</span> <span class="n">x_type</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">o_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_optimizer_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o_type</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">x_name</span><span class="p">:</span>
                    <span class="n">x_type</span> <span class="o">=</span> <span class="n">o_type</span>

        <span class="c1"># Exporter</span>
        <span class="k">if</span> <span class="n">x_type</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">available_exporter_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e_type</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">x_name</span><span class="p">:</span>
                    <span class="n">x_type</span> <span class="o">=</span> <span class="n">e_type</span>
        <span class="c1"># Not Found</span>
        <span class="k">if</span> <span class="n">x_type</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;The x_name argument of button_pressed must be the __name__ of an Importer, Restraint, Selection, Filter, Optimizer or Exporter. Not: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">x_name</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">set_action_type</span><span class="p">(</span><span class="n">x_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>  <span class="c1"># Actually only necessary after Optimizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">refresh_wizard</span><span class="p">()</span></div>

<div class="viewcode-block" id="Restraints_Wizard._toggle_button_pressed"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard._toggle_button_pressed">[docs]</a>    <span class="k">def</span> <span class="nf">_toggle_button_pressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        _mode_button pressed is called when one of the 2 buttons defining the user mode is pressed.</span>

<span class="sd">        :param button: Which button was pressed</span>
<span class="sd">        :type button: str</span>
<span class="sd">        :return: -</span>
<span class="sd">        :rtype: -</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="s1">&#39;toggle_delete&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="n">select_delete</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">select_or_delete_mode</span><span class="p">,</span>
                                        <span class="n">atom_restraint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">atom_or_restraint_mode</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="s1">&#39;toggle_atom&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="n">select_delete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">select_or_delete_mode</span><span class="p">,</span>
                                        <span class="n">atom_restraint</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">atom_or_restraint_mode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;_toggle_button_pressed needs to be called with </span><span class="se">\&#39;</span><span class="s1">button</span><span class="se">\&#39;</span><span class="s1"> = toggle_delte or toggle_atom. Not &#39;</span> <span class="o">+</span> <span class="n">button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_panel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">refresh_wizard</span><span class="p">()</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility functions</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Restraints_Wizard.get_prompt"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.get_prompt">[docs]</a>    <span class="k">def</span> <span class="nf">get_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;called automatically upon refresh wizard&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supress_prompt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SUPRESSING PROMPT&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">prompt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_message</span><span class="p">:</span>
            <span class="n">prompt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;show instructions: s&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prompt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;hide instructions: h&#39;</span><span class="p">)</span>
            <span class="n">prompt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="c1"># Current mode</span>
            <span class="n">mode</span><span class="p">,</span> <span class="n">instruction</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">atom_or_restraint_mode</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">select_or_delete_mode</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;SELECT ATOMS MODE&#39;</span>
                    <span class="n">instruction</span> <span class="o">=</span> <span class="s1">&#39;select atoms using selections&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;DELETE ATOMS MODE&#39;</span>
                    <span class="n">instruction</span> <span class="o">=</span> <span class="s1">&#39;delete atoms using selections&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">select_or_delete_mode</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;SELECT RESTRAINTS MODE&#39;</span>
                    <span class="n">instruction</span> <span class="o">=</span> <span class="s1">&#39;create (distance) restraints by clicking atoms&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;DELETE RESTRAINTS MODE&#39;</span>
                    <span class="n">instruction</span> <span class="o">=</span> <span class="s1">&#39;delete restraints by clicking atoms&#39;</span>

            <span class="n">prompt</span> <span class="o">+=</span> <span class="p">[</span><span class="n">mode</span><span class="p">,</span> <span class="n">instruction</span><span class="p">]</span>

            <span class="c1"># How to use a selection</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">current_selection_type</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">prompt</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECTION&#39;</span><span class="p">,</span> \
                           <span class="s1">&#39;select: lft clck&#39;</span><span class="p">,</span> \
                           <span class="s1">&#39;cnfrm: shft+up&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;SphericalSelection&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">():</span>
                    <span class="n">prompt</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="s1">&#39;size: left / right&#39;</span> \
                        <span class="s1">&#39;move/rotate: mouse, left&#39;</span><span class="p">,</span> \
                        <span class="s1">&#39;activate rota: up&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;activate move: down&#39;</span><span class="p">]</span>

            <span class="c1"># How to get into test mode</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_restraints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">prompt</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;TEST MODES&#39;</span><span class="p">,</span> \
                           <span class="s1">&#39;Show restraints pairwise: Shift + Enter&#39;</span><span class="p">]</span>

            <span class="c1"># If in test mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">prompt</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;TEST MODE: Pairwise&#39;</span><span class="p">,</span> \
                           <span class="s1">&#39;leave check mode: Shft+Enter&#39;</span><span class="p">,</span> \
                           <span class="s1">&#39;show next pair: Enter&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">prompt</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;show molecule #: number-keys&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">prompt</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;show previous pair #: backspace&#39;</span><span class="p">]</span>

            <span class="c1"># Shortcuts</span>
            <span class="n">prompt</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;SHORTCUTS&#39;</span><span class="p">,</span> \
                       <span class="s1">&#39;Shft r: del. all rest.&#39;</span><span class="p">,</span> \
                       <span class="s1">&#39;Shft q: instant tree&#39;</span><span class="p">,</span> \
                       <span class="s1">&#39;Shft s: snapshot&#39;</span><span class="p">,</span> \
                       <span class="s1">&#39;spcace: grid view&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">prompt</span></div>

<div class="viewcode-block" id="Restraints_Wizard.get_panel"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.get_panel">[docs]</a>    <span class="k">def</span> <span class="nf">get_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">empty_panel</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]]</span>  <span class="c1"># Empty Space</span>

        <span class="c1"># shorthand to get the name of an  class</span>
        <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="n">x_type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;-&#39;</span> <span class="k">if</span> <span class="n">x_type</span> <span class="o">==</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x_type</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="n">empty_panel</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]]</span>

        <span class="n">text_select_delete</span> <span class="o">=</span> <span class="s1">&#39;select (x) | delete    ( )&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">select_or_delete_mode</span> \
            <span class="k">else</span> <span class="s1">&#39;select ( ) | delete    (x)&#39;</span>

        <span class="n">text_atom_restraint_mode</span> <span class="o">=</span> <span class="s1">&#39;atoms  (x) | restraints ( )&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">atom_or_restraint_mode</span> \
            <span class="k">else</span> <span class="s1">&#39;atoms  ( ) | restraints (x)&#39;</span>

        <span class="n">menu</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">menu</span> <span class="o">+=</span> <span class="n">empty_panel</span>
        <span class="n">menu</span> <span class="o">+=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">_action_states</span><span class="p">[</span><span class="s1">&#39;toggle_select_delete&#39;</span><span class="p">]),</span> <span class="n">text_select_delete</span><span class="p">,</span>
                  <span class="s1">&#39;cmd.get_wizard()._toggle_button_pressed(</span><span class="se">\&quot;</span><span class="s1">toggle_delete</span><span class="se">\&quot;</span><span class="s1">)&#39;</span><span class="p">]]</span>
        <span class="n">menu</span> <span class="o">+=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">_action_states</span><span class="p">[</span><span class="s1">&#39;toggle_select_delete&#39;</span><span class="p">]),</span> <span class="n">text_atom_restraint_mode</span><span class="p">,</span>
                  <span class="s1">&#39;cmd.get_wizard()._toggle_button_pressed(</span><span class="se">\&quot;</span><span class="s1">toggle_atom</span><span class="se">\&quot;</span><span class="s1">)&#39;</span><span class="p">]]</span>

        <span class="n">menu</span> <span class="o">+=</span> <span class="n">empty_panel</span>
        <span class="n">menu</span> <span class="o">+=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">_action_states</span><span class="p">[</span><span class="s1">&#39;Importer&#39;</span><span class="p">]),</span>
                  <span class="s1">&#39;Import:&#39;</span> <span class="o">+</span> <span class="n">get_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">current_importer_type</span><span class="p">),</span> <span class="s1">&#39;Import&#39;</span><span class="p">]]</span>
        <span class="n">menu</span> <span class="o">+=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">_action_states</span><span class="p">[</span><span class="s1">&#39;Restraint&#39;</span><span class="p">]),</span>
                  <span class="s1">&#39;Restraint:&#39;</span> <span class="o">+</span> <span class="n">get_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">current_restraint_type</span><span class="p">),</span> <span class="s1">&#39;Restraint&#39;</span><span class="p">]]</span>
        <span class="n">menu</span> <span class="o">+=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">_action_states</span><span class="p">[</span><span class="s1">&#39;Selection&#39;</span><span class="p">]),</span>
                  <span class="s1">&#39;Selection: &#39;</span> <span class="o">+</span> <span class="n">get_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">current_selection_type</span><span class="p">),</span> <span class="s1">&#39;Selection&#39;</span><span class="p">]]</span>
        <span class="n">menu</span> <span class="o">+=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">_action_states</span><span class="p">[</span><span class="s1">&#39;Filter&#39;</span><span class="p">]),</span>
                  <span class="s1">&#39;Filter: &#39;</span> <span class="o">+</span> <span class="n">get_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">current_filter_type</span><span class="p">),</span> <span class="s1">&#39;Filter&#39;</span><span class="p">]]</span>
        <span class="n">menu</span> <span class="o">+=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">_action_states</span><span class="p">[</span><span class="s1">&#39;Optimizer&#39;</span><span class="p">]),</span>
                  <span class="s1">&#39;Optimizer: &#39;</span> <span class="o">+</span> <span class="n">get_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">current_optimizer_type</span><span class="p">),</span> <span class="s1">&#39;Optimizer&#39;</span><span class="p">]]</span>
        <span class="n">menu</span> <span class="o">+=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">_action_states</span><span class="p">[</span><span class="s1">&#39;Exporter&#39;</span><span class="p">]),</span>
                  <span class="s1">&#39;Exporter: &#39;</span> <span class="o">+</span> <span class="n">get_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">current_exporter_type</span><span class="p">),</span> <span class="s1">&#39;Exporter&#39;</span><span class="p">]]</span>
        <span class="n">menu</span> <span class="o">+=</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">_action_states</span><span class="p">[</span><span class="s1">&#39;Done&#39;</span><span class="p">]),</span> <span class="s1">&#39;Done&#39;</span><span class="p">,</span> <span class="s1">&#39;cmd.set_wizard()&#39;</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">menu</span></div>

<div class="viewcode-block" id="Restraints_Wizard.set_wizard_style"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.set_wizard_style">[docs]</a>    <span class="k">def</span> <span class="nf">set_wizard_style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="s2">&quot;elem C&quot;</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="s2">&quot;set sphere_scale, 0.2&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Restraints_Wizard.provide_services_to_spherical_selection"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.provide_services_to_spherical_selection">[docs]</a>    <span class="k">def</span> <span class="nf">provide_services_to_spherical_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># 1st call: Draw Pseudoatom, set mouse function. Register with dirty listener, mask atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">pseudoatom</span><span class="p">(</span><span class="s2">&quot;SphericalSelection&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="s1">&#39;not SphericalSelection&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s1">&#39;sphere&#39;</span><span class="p">,</span> <span class="s1">&#39;SphericalSelection&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;sphere_scale&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="s1">&#39;SphericalSelection&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;sphere_transparency&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;SphericalSelection&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">controlling</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Left&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;MovA&#39;</span><span class="p">)</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility functions that need to be part of the Distance_Restraints class</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Restraints_Wizard.create_pymol_objects_for_restraints"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.create_pymol_objects_for_restraints">[docs]</a>    <span class="k">def</span> <span class="nf">create_pymol_objects_for_restraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># DELTE ALL PYMOL RESTRAINT OBJECTS (They are not on the object list =&gt; Need to reconstruct their names here)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;rest_&#39;</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span>

        <span class="c1"># CREATE NEW RESTRAINT OBJECTS FOR EACH MOLECULE SEPARATELY. (Not every Molecule pair becasue it has to be generalizeable to other Restraints than PairRestraint)</span>
        <span class="c1"># =&gt; the same restraint will appear in several lists</span>

        <span class="k">def</span> <span class="nf">_connect_atoms</span><span class="p">(</span><span class="n">atom_list</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">Atom</span><span class="p">],</span> <span class="n">restraint_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i_a1</span><span class="p">,</span> <span class="n">a1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atom_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">atom_list</span><span class="p">[</span><span class="n">i_a1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">restraint_name</span><span class="p">,</span> \
                                      <span class="n">selection1</span><span class="o">=</span><span class="n">pu</span><span class="o">.</span><span class="n">_atom_list_to_pymol_selection</span><span class="p">([</span><span class="n">a1</span><span class="p">]),</span> \
                                      <span class="n">selection2</span><span class="o">=</span><span class="n">pu</span><span class="o">.</span><span class="n">_atom_list_to_pymol_selection</span><span class="p">([</span><span class="n">a2</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pymol_molecule_objects</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_restraints</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">atm</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;mol_&#39;</span> <span class="o">+</span> <span class="n">atm</span><span class="o">.</span><span class="n">resi</span> <span class="o">==</span> <span class="n">mol</span><span class="p">:</span>
                        <span class="n">_connect_atoms</span><span class="p">(</span><span class="n">atom_list</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">restraint_name</span><span class="o">=</span><span class="s1">&#39;rest_&#39;</span> <span class="o">+</span> <span class="n">mol</span><span class="p">)</span>
                        <span class="k">break</span></div>

<div class="viewcode-block" id="Restraints_Wizard.check_objects_exists"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.check_objects_exists">[docs]</a>    <span class="k">def</span> <span class="nf">check_objects_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check_if_onject_exists checks if a interface_Pymol object of a certain name existst.</span>
<span class="sd">        :warning: Pymol does not count Selections as objects.</span>

<span class="sd">        :param sele: Name of a interface_Pymol selection</span>
<span class="sd">        :type sele: str</span>
<span class="sd">        :return: Selection contains at least one object: True. Selection does not exist or is empty: False</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()</span></div>

<div class="viewcode-block" id="Restraints_Wizard.redraw"><a class="viewcode-back" href="../../../_source/restraintmaker.interface_Pymol.html#restraintmaker.interface_Pymol.RestraintMaker_Pymol.Restraints_Wizard.redraw">[docs]</a>    <span class="k">def</span> <span class="nf">redraw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw paints all selected atoms, and the atoms in the active selection in different colours. Sets all other atoms back to standard colours</span>

<span class="sd">        Different colours for 1) Atoms in the curently active selections (not yet confirmed)</span>
<span class="sd">                              2) Selected Atoms</span>
<span class="sd">                              3) Atoms in restraints</span>
<span class="sd">                              4) Atoms in restraints we are looking at at the moment (in tst mode))</span>
<span class="sd">        :return: -</span>
<span class="sd">        :rtype: -</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Has anything that influences the coloring of atoms changed?</span>

        <span class="n">atoms_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_atoms</span><span class="p">))</span>
        <span class="n">selection_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span><span class="o">.</span><span class="n">atoms</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">hash</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">([</span><span class="kc">None</span><span class="p">]))</span>
        <span class="n">restraints_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_restraints</span><span class="p">))</span>
        <span class="n">test_mode_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_result_dict</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">atoms_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_hashes</span><span class="p">[</span><span class="s1">&#39;atoms&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">selection_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_hashes</span><span class="p">[</span><span class="s1">&#39;selection&#39;</span><span class="p">]</span> \
                <span class="ow">or</span> <span class="n">restraints_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_hashes</span><span class="p">[</span><span class="s1">&#39;restraints&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">test_mode_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_hashes</span><span class="p">[</span><span class="s1">&#39;test_mode&#39;</span><span class="p">]:</span>

            <span class="c1"># 0) Recolour all atoms to standard colour</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cba</span><span class="p">(</span>
                    <span class="s1">&#39;vanadium&#39;</span><span class="p">)</span>  <span class="c1"># The colour for carbon atoms needs to be given explicitly. WARNING; The python cba command does not work properly. It does not work at all with gray. It raises an exception with vanadium, but it does paint it corectly.</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># 1) Colour selected atoms</span>
            <span class="n">pu</span><span class="o">.</span><span class="n">help_pymol_with_big_atom_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_atoms</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>

            <span class="c1"># 2) Colour atoms in current selection</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pu</span><span class="o">.</span><span class="n">help_pymol_with_big_atom_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>

            <span class="c1"># 3) Colour atoms in restraints</span>

            <span class="c1"># Have the restraints changed?</span>
            <span class="k">if</span> <span class="n">restraints_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_hashes</span><span class="p">[</span><span class="s1">&#39;restraints&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_hashes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">restraints</span><span class="o">=</span><span class="n">restraints_hash</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_pymol_objects_for_restraints</span><span class="p">()</span>

            <span class="n">restrained_atoms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_restraints</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span> <span class="n">restrained_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

            <span class="c1"># 3a) Colour all restrained atoms</span>
            <span class="n">pu</span><span class="o">.</span><span class="n">help_pymol_with_big_atom_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">restrained_atoms</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;marine&#39;</span><span class="p">)</span>

            <span class="c1"># 3b) In test mode: Colour atoms in restraints we are looking at at the moment</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="ow">and</span> <span class="n">test_mode_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_hashes</span><span class="p">[</span><span class="s1">&#39;test_mode&#39;</span><span class="p">]:</span>
                <span class="n">restrained_atoms</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_restraints</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_result_dict</span><span class="p">[</span><span class="s1">&#39;mol1&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">resi</span> <span class="o">==</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">check_result_dict</span><span class="p">[</span><span class="s1">&#39;mol2&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">:])</span> \
                                <span class="ow">or</span> <span class="p">(</span>
                                <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_result_dict</span><span class="p">[</span><span class="s1">&#39;mol2&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">resi</span> <span class="o">==</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">check_result_dict</span><span class="p">[</span><span class="s1">&#39;mol1&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">:]):</span>
                            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span> <span class="n">restrained_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_results_mode</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">selected_restraints</span><span class="p">:</span>
                        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_result_dict</span><span class="p">[</span><span class="s1">&#39;pairs&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">check_result_dict</span><span class="p">[</span><span class="s1">&#39;i_pair&#39;</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resi</span> <span class="o">==</span> <span class="n">m1</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">resi</span> <span class="o">==</span> <span class="n">m2</span><span class="p">)</span> \
                                <span class="ow">or</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resi</span> <span class="o">==</span> <span class="n">m2</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">resi</span> <span class="o">==</span> <span class="n">m1</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span> <span class="n">restrained_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

                <span class="n">pu</span><span class="o">.</span><span class="n">help_pymol_with_big_atom_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">restrained_atoms</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">last_hashes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="n">atoms_hash</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="n">selection_hash</span><span class="p">,</span> <span class="n">restraints</span><span class="o">=</span><span class="n">restraints_hash</span><span class="p">,</span>
                                    <span class="n">test_mode</span><span class="o">=</span><span class="n">test_mode_hash</span><span class="p">)</span>
        <span class="c1"># -----------END OF if has has changed clause-------------------------------------</span>

        <span class="c1"># SPECIAL CASE FOR SPHERICAL SELECTION; CHECK IF SPHERICAL SELECTION IS STILL ACTIVE</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logic_handler</span><span class="o">.</span><span class="n">my_selection</span><span class="p">,</span> <span class="n">SphericalSelection</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_objects_exists</span><span class="p">(</span>
                <span class="s1">&#39;SphericalSelection&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">unmask</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;SphericalSelection&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Left&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s2">&quot;Rota&quot;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Benjamin Ries, Clemens Rhiner. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.3

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>